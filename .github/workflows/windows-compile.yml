# Platform specific Windows test. See verible-ci for main continuous integration.
name: windows-compile

on:
  push:
    branches:
    - master
    - main
  pull_request:
    branches:
    - master
    - main

jobs:
  WindowsBuild:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Install dependencies
      run: choco install llvm
    # Only check flex/bison targets at the moment, since Verible cannot be
    # fully compiled on Windows (yet!)
    - name: Build flex/bison files
      run: |
        bazel build //common/analysis:command_file_lex
        bazel build //verilog/parser:verilog_y
        bazel build //verilog/parser:verilog_lex
    # Windows support is in progress, only run "working" tests
    - name: Run known-to-work tests
      run: |
        bazel test  --test_output=errors `
                    //common/... `
                    //external_libs/... `
                    //verilog/analysis:descriptions_test `
                    //verilog/analysis:extractors_test `
                    //verilog/analysis:json_diagnostics_test `
                    //verilog/analysis:lint_rule_registry_test `
                    //verilog/analysis:verilog_analyzer_test `
                    //verilog/analysis:verilog_equivalence_test `
                    //verilog/analysis/checkers/... `
                    //verilog/CST/... `
                    //verilog/formatting/... `
                    //verilog/parser/... `
                    //verilog/preprocessor/... `
                    //verilog/tools/kythe:indexing_facts_tree_test `
                    //verilog/tools/kythe:kythe_facts_test `
                    //verilog/tools/kythe:scope_resolver_test `
                    //verilog/transform/...
